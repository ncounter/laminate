<html>
  <head>
    <meta charset="utf-8"/>
    <title>Laminate.js Tester</title>
    <style>
      input[type='text'] {
        width: 500px;
      }
      input, label{
        vertical-align: middle;
      }
      label {
        margin-right: 1em;
      }
      p {
        margin: 1.5em;
      }
      i {
        display: inline-block;
        margin-bottom: 0.3em;
      }
    </style>
    <script type="text/javascript" src="laminate.js"></script>
  </head>
  <body>
    <h3>Laminate.js tester</h3>
    <span>Open browser's Development Tools pane and take a look at the "Console" tab or at "Network" tab</span>
    <p>
      <i>Set the backend URL where to POST the log message <small>(e.g.:  https://httpbin.org/post )</small></i>
      <br />
      <input type='text' name='backend-URL' placeholder='set the backend URL' value='https://httpbin.org/post' />
    </p>
    <p>
      <i>Prepare the log message for the test</i>
      <br />
      <input type='text' name='log-message' placeholder='write a log message to send' />
    </p>
    <p>
      <i>Choose the severity log-level you want to test</i>
      <br />
      <input type='radio' id='info-level' value='info' name='log-level' checked /><label for='info-level'>info</label>
      <input type='radio' id='debug-level' value='debug' name='log-level' /><label for='debug-level'>debug</label>
      <input type='radio' id='warning-level' value='warning' name='log-level' /><label for='warning-level'>warning</label>
      <input type='radio' id='error-level' value='error' name='log-level' /><label for='error-level'>error</label>
    </p>
    <p>
      <label for='alert-on-error'>
        <i>Enable alert on error</i>
      </label>
      <input type='checkbox' id='alert-on-error' checked='checked' name='alert-on-error' />
    </p>
    <p>
      <i>Send the log message via Laminate.js</i>
      <br />
      <button id='send-log'>Send Log Message</button>
    </p>
    <p>
      <i>Send the log message via Laminate.js after throwing a Javascript error</i>
      <br />
      <button id='throw-error'>Throw Error</button>
    </p>
    <p id='text-result'>
    </p>

    <script>
      const Log = window.Laminate;
      const backendURLInput = document.getElementsByName('backend-URL')[0];
      backendURLInput.addEventListener('keyup', (e) => Log.setBackendURL(e.target.value));
      backendURLInput.addEventListener('change', (e) => Log.setBackendURL(e.target.value));

      document.getElementById('alert-on-error')
          .addEventListener('change', (e) => Log.enableAlertOnErrorLevel(e.target.checked));
      Log.enableAlertOnErrorLevel(document.getElementById('alert-on-error').checked);

      Log.setBackendURL('https://httpbin.org/post');

      function writeResponse (jsonText) {
        document.getElementById('text-result').innerHTML = JSON.stringify(jsonText)
      }

      function sendLog() {
        const message = document.getElementsByName('log-message')[0].value;
        let result;
        switch(document.querySelector('input[name="log-level"]:checked').value) {
          case 'info': result = Log.info(message); break;
          case 'debug': result = Log.debug(message); break;
          case 'warning': result = Log.warning(message); break;
          case 'error': result = Log.error(message); break;
        }

        if (result){
          result.then(resultJson => writeResponse(resultJson));
        }
      }
      document.getElementById('send-log').addEventListener('click', sendLog);

      function newError() {
        throw new Error("boom!");
      }
      document.getElementById('throw-error').addEventListener('click', newError);
    </script>
  </body>
</html>
